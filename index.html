<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Atmosphere / Soft Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { 
            --text-main: #444b54; 
            --accent-soft: rgba(0,0,0,0.05);
        }
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #f4f4f4; color: var(--text-main); font-family: 'Inter', sans-serif; }
        
        #vfx-layer { position: fixed; inset: 0; z-index: 0; transition: background 3s ease; }
        
        /* Glassmorphism for Light Mode */
        .glass-light { 
            background: rgba(255, 255, 255, 0.4); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.5); 
            border-radius: 4rem; 
        }

        /* Particle VFX - Adjusted for Visibility on Light Backgrounds */
        .rain { position: absolute; background: rgba(70, 130, 180, 0.4); width: 1px; }
        .snow { position: absolute; background: white; border-radius: 50%; box-shadow: 0 0 5px rgba(0,0,0,0.05); }
        
        .big-temp {
            font-size: clamp(8rem, 20vw, 15rem);
            font-weight: 200;
            letter-spacing: -0.05em;
            color: var(--text-main);
            opacity: 0.9;
        }

        input::placeholder { color: #999; }
    </style>
</head>
<body class="flex items-center justify-center">

    <div id="vfx-layer"></div>

    <main class="relative z-10 w-full max-w-4xl px-10">
        <div id="search-container" class="text-center transition-all duration-700">
            <h1 class="text-[10px] tracking-[1.5em] uppercase opacity-40 mb-32">Atmosphere</h1>
            <input type="text" id="city-input" placeholder="Find a place..." 
                   class="bg-transparent border-b border-black/10 w-full max-w-sm py-4 text-center text-sm focus:outline-none focus:border-black/30 transition-all">
            <div id="results" class="mt-6 flex flex-col space-y-3 text-[11px] tracking-widest uppercase opacity-60"></div>
        </div>

        <div id="weather-display" class="hidden text-center opacity-0 transition-all duration-1000 translate-y-4">
            <div id="icon" class="text-5xl mb-6 grayscale opacity-60">‚òÄÔ∏è</div>
            <div class="big-temp relative inline-block">
                <span id="temp">--</span><span class="text-[0.2em] absolute top-8 -right-10">¬∞</span>
            </div>
            <div class="mt-8">
                <h2 id="city-name" class="text-sm tracking-[0.8em] uppercase font-medium">---</h2>
                <p id="desc" class="text-[9px] tracking-[0.4em] uppercase opacity-40 mt-2">---</p>
            </div>

            <div class="flex justify-center space-x-16 mt-20 text-[10px] tracking-[0.3em] uppercase opacity-40">
                <div><p>Wind</p><p id="wind" class="mt-1 font-bold">--</p></div>
                <div><p>Humid</p><p id="humid" class="mt-1 font-bold">--</p></div>
            </div>
            
            <button onclick="location.reload()" class="mt-24 text-[8px] tracking-[0.5em] opacity-30 hover:opacity-100 transition-opacity uppercase">Change Location</button>
        </div>
    </main>

    <script>
        const vfx = document.getElementById('vfx-layer');
        const searchUI = document.getElementById('search-container');
        const displayUI = document.getElementById('weather-display');

        // Atmospheric Color Palette (Dull/Muted)
        const weatherPalettes = {
            clear: 'linear-gradient(135deg, #e0f2f1 0%, #fce4ec 100%)', // Soft Peach/Mint
            clouds: 'linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%)', // Muted Sky Blue
            rain: 'linear-gradient(135deg, #d7d2cc 0%, #304352 100%)',    // Foggy Grey-Blue (lightened)
            snow: 'linear-gradient(135deg, #e6e9f0 0%, #eef1f5 100%)',    // Paper White
            fog: 'linear-gradient(135deg, #bdc3c7 0%, #ebedee 100%)'      // Mist Grey
        };

        async function fetchManual(name, lat, lon) {
            searchUI.style.opacity = '0';
            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&timezone=auto`);
            const data = await res.json();
            
            setTimeout(() => {
                searchUI.classList.add('hidden');
                displayUI.classList.remove('hidden');
                setTimeout(() => displayUI.classList.add('opacity-100', 'translate-y-0'), 50);
                render(data.current, name);
            }, 600);
        }

        function render(data, name) {
            const code = data.weather_code;
            document.getElementById('temp').innerText = Math.round(data.temperature_2m);
            document.getElementById('city-name').innerText = name;
            document.getElementById('wind').innerText = data.wind_speed_10m + ' KM/H';
            document.getElementById('humid').innerText = data.relative_humidity_2m + '%';

            let mode = 'clear', icon = '‚òÄÔ∏è', desc = 'Clear';
            if (code >= 71) { mode = 'snow'; icon = '‚ùÑÔ∏è'; desc = 'Snow'; }
            else if (code >= 51) { mode = 'rain'; icon = 'üåßÔ∏è'; desc = 'Rain'; }
            else if (code >= 45) { mode = 'fog'; icon = 'üå´Ô∏è'; desc = 'Fog'; }
            else if (code >= 1) { mode = 'clouds'; icon = '‚òÅÔ∏è'; desc = 'Cloudy'; }

            document.getElementById('icon').innerText = icon;
            document.getElementById('desc').innerText = desc;
            
            vfx.style.background = weatherPalettes[mode] || weatherPalettes.clear;
            applyParticles(mode);
        }

        function applyParticles(mode) {
            vfx.innerHTML = '';
            if (mode === 'rain' || mode === 'snow') {
                for (let i = 0; i < 50; i++) {
                    const p = document.createElement('div');
                    p.className = mode;
                    p.style.left = Math.random() * 100 + '%';
                    if (mode === 'rain') {
                        p.style.height = (Math.random() * 30 + 10) + 'px';
                        p.animate([{top: '-10%'}, {top: '110%'}], {duration: 600 + Math.random()*400, iterations: Infinity});
                    } else {
                        p.style.width = p.style.height = (Math.random() * 5 + 2) + 'px';
                        p.animate([{top: '-5%', opacity: 0}, {top: '100%', opacity: 1}], {duration: 4000 + Math.random()*3000, iterations: Infinity});
                    }
                    vfx.appendChild(p);
                }
            }
        }

        // Search logic
        document.getElementById('city-input').addEventListener('input', async (e) => {
            const q = e.target.value;
            if (q.length < 2) return;
            const res = await fetch(`https://photon.komoot.io/api/?q=${encodeURIComponent(q)}&limit=3`);
            const data = await res.json();
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = data.features.map(f => `
                <div class="cursor-pointer hover:opacity-100 transition-opacity" 
                     onclick="fetchManual('${f.properties.name}', ${f.geometry.coordinates[1]}, ${f.geometry.coordinates[0]})">
                    ${f.properties.name} / ${f.properties.country}
                </div>
            `).join('');
        });

        // Initialize background
        vfx.style.background = weatherPalettes.clear;
    </script>
</body>
</html>
